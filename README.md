## Iface.Oik.TaskExample

Программа на языке C# для разработчиков с примерами вызова API сервера «ОИК Диспетчер НТ».

Для использования, написания и отладки программы рекомендуется использовать среду разработки Visual Studio 2022 и выше, с установленным .NET SDK 6 или выше.

Для отладки из среды разработки нужно указать следующие параметры запуска:

    сервер_динамических_данных компьютер имя_пользователя пароль
    
Например:

    TMS 10.0.0.69 admin password
	
При использовании в качестве внешней задачи сервера, аргументы указывать не требуется.

Для работы программы на рабочем сервере должен быть установлен .NET Desktop Runtime 6.x - https://dotnet.microsoft.com/en-us/download/dotnet/6.0

## Кратко о принципе работы кода

### Program.cs
Точка входа в программу. Внутри вызывается функция связи с сервером ОИК Диспетчер НТ, регистрируются требуемые службы.

Файл не требует редактирования, кроме указания классов, содержащих логику задачи, которые напишет разработчик.

Для каждого класса требуется добавить следующую строку с указанием его названия (в примере Worker):

```
services.AddHostedService<Worker>();
```

### TmStartup.cs
Описание установки связи с сервером ОИК Диспетчер НТ и завершение работы в случае получения команды остановки от сервера.

Файл не требует редактирования, кроме указания имени программы:

```
private const string ApplicationName = "TaskExample";
private const string TraceName       = "TaskExample";
private const string TraceComment    = "<Iface.Oik.TaskExample>";
```

### Worker.cs (Worker2.cs и т.д.)
Этот и последущий класс в примерах реализует требуемую логику задачи - чтение данных с сервера, выполнение каких-то расчетов, запись результатов, подача команд и т.д.

Все они для работают по общему принципу: при старте задачи вызывается метод `ExecuteAsync`, внутри которого в бесконечном цикле (до получения команды остановки программы) будет вызываться основной метод `DoWork`, с паузой между вызовами, заданной в константе `WorkerDelay`.

При необходимости можно полностью изменить принцип работы каждого класса.

Допускается пользоваться как одним классом, так и создать сколько угодно классов логики, каждый из которых будет работать в собственном потоке, независимо от остальных.

После описания требуемой логики нужно не забыть зарегистрировать все нужные классы в файле `Program.cs`.

## Публикация готового проекта

После завершения работы над задачей нужно опубликовать проект. Это можно сделать либо средствами Visual Studio, либо с помощью терминала и команды `dotnet publish` с нужными аргументами.

Пример команд публикации для использования в ОС Windows и ОС Linux соответственно

```
dotnet publish -c Release -r win-x64 -p:CopyOutputSymbolsToPublishDirectory=false -p:PublishSingleFile=true --self-contained false -o путь_к_папке_сборки
```

```
dotnet publish -c Release -r linux-x64 -p:CopyOutputSymbolsToPublishDirectory=false -p:PublishSingleFile=true --self-contained false -o путь_к_папке_сборки
```